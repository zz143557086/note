### 线程

1.每个进程可以有多个线程，cpu一核对应一线程

2.线程使用系统分配给进程的内存，线程之间共享内存

3.runtime中使用 m结构体来记录线程

#### 线程的问题

线程本身占用资源大，线程的操作开销大，线程切换开销大

### 协程

1.协程就是将一段程序的运行状态打包，可以再线程之间调度

2.将生产流程打包，使得流程不固定在生产线上

3.协程并不取代线程，协程也要在线程上运行

4.线程是协程的资源，协程使用线程这个资源

#### 5.runtime中，协程的本质就是一个g结构体

​	stack:堆栈地址 gobuf:目前程序运行现场 atomicstatus:协程状态

#### 协程优势

资源利用，快速调度，超高并发 

#### 新建协程

随机寻找一个p，将新协程放入p的runnext(插队)，若p本地队列满，放入全局队列

#### 解决协程饥饿问题

gopark 协程主动挂起

系统调用exitsyscall 停止线程执行

runtime.morestack() 每一次函数跳转调用 作用:本意检查协程栈是否有足够空间
